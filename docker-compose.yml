version: '3.8'

services:
  forum:
    build:
      context: .
      dockerfile: dockerfile
    container_name: forum-app
    ports:
      - "8080:8080"
    environment:
      # Server configuration
      - PORT=8080
      - ENV=production
      
      # Database configuration
      - DB_PATH=server/database/database.db
      - DB_MAX_OPEN_CONNS=25
      - DB_MAX_IDLE_CONNS=5
      - DB_CONN_MAX_LIFETIME=5m
      
      # Timeouts
      - READ_TIMEOUT=15s
      - WRITE_TIMEOUT=15s
      - IDLE_TIMEOUT=60s
      
      # Application configuration
      - BASE_PATH=/app/
      - APP_VERSION=1.0.0
      
      # Cache configuration
      - CACHE_TEMPLATE_TTL=1h
      - CACHE_SESSION_TTL=10m
      - CACHE_POST_TTL=5m
    
    volumes:
      # Persist database
      - forum-data:/app/server/database
      # Optional: Mount logs directory if you implement file logging
      # - forum-logs:/app/logs
    
    restart: unless-stopped
    
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 3s
      start_period: 5s
      retries: 3
    
    networks:
      - forum-network

volumes:
  forum-data:
    driver: local

networks:
  forum-network:
    driver: bridge
